@inherits LayoutComponentBase
@inject IJSRuntime JS

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <button class="btn btn-link ms-auto" @onclick="ToggleTheme" title="Cambiar tema">
                <span class="bi @(isDark ? "bi-sun" : "bi-moon")"></span>
            </button>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private bool isDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        var saved = await JS.InvokeAsync<string>("theme.get");
        isDark = saved == "dark";
        await JS.InvokeVoidAsync("theme.set", saved);
        StateHasChanged();
    }

    private async Task ToggleTheme()
    {
        isDark = !isDark;
        await JS.InvokeVoidAsync("theme.set", isDark ? "dark" : "light");
    }
}